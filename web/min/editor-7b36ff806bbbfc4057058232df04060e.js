(function(){function e(a){return function(c,b,g,d){b=x(b,d,4);var e=!t(c)&&f.keys(c),k=(e||c).length,h=0<a?0:k-1;3>arguments.length&&(g=c[e?e[h]:h],h+=a);for(var n=b,l=g;0<=h&&k>h;h+=a)var m=e?e[h]:h,l=n(l,c[m],m,c);return l}}function l(a){return function(c,b,f){b=r(b,f);f=v(c);for(var g=0<a?0:f-1;0<=g&&f>g;g+=a)if(b(c[g],g,c))return g;return-1}}function m(a,c,b){return function(g,d,e){var h=0,n=v(g);if("number"==typeof e)0<a?h=0<=e?e:Math.max(e+n,h):n=0<=e?Math.min(e+1,n):e+n+1;else if(b&&e&&n)return e=
b(g,d),g[e]===d?e:-1;if(d!==d)return e=c(k.call(g,h,n),f.isNaN),0<=e?e+h:-1;for(e=0<a?h:n-1;0<=e&&n>e;e+=a)if(g[e]===d)return e;return-1}}function h(a,b){var g=H.length,e=a.constructor,e=f.isFunction(e)&&e.prototype||c,d="constructor";for(f.has(a,d)&&!f.contains(b,d)&&b.push(d);g--;)d=H[g],d in a&&a[d]!==e[d]&&!f.contains(b,d)&&b.push(d)}var d=this,b=d._,a=Array.prototype,c=Object.prototype,g=a.push,k=a.slice,n=c.toString,p=c.hasOwnProperty,q=Array.isArray,y=Object.keys,B=Function.prototype.bind,
I=Object.create,C=function(){},f=function(a){return a instanceof f?a:this instanceof f?void(this._wrapped=a):new f(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=f),exports._=f):d._=f;f.VERSION="1.8.3";var x=function(a,c,b){if(void 0===c)return a;switch(null==b?3:b){case 1:return function(b){return a.call(c,b)};case 2:return function(b,f){return a.call(c,b,f)};case 3:return function(b,f,g){return a.call(c,b,f,g)};case 4:return function(b,f,g,M){return a.call(c,
b,f,g,M)}}return function(){return a.apply(c,arguments)}},r=function(a,c,b){return null==a?f.identity:f.isFunction(a)?x(a,c,b):f.isObject(a)?f.matcher(a):f.property(a)};f.iteratee=function(a,c){return r(a,c,1/0)};var z=function(a,c){return function(b){var f=arguments.length;if(2>f||null==b)return b;for(var g=1;f>g;g++)for(var d=arguments[g],e=a(d),h=e.length,k=0;h>k;k++){var n=e[k];c&&void 0!==b[n]||(b[n]=d[n])}return b}},J=function(a){if(!f.isObject(a))return{};if(I)return I(a);C.prototype=a;a=new C;
return C.prototype=null,a},A=function(a){return function(c){return null==c?void 0:c[a]}},N=Math.pow(2,53)-1,v=A("length"),t=function(a){a=v(a);return"number"==typeof a&&0<=a&&N>=a};f.each=f.forEach=function(a,c,b){c=x(c,b);var g;if(t(a))for(b=0,g=a.length;g>b;b++)c(a[b],b,a);else{var d=f.keys(a);b=0;for(g=d.length;g>b;b++)c(a[d[b]],d[b],a)}return a};f.map=f.collect=function(a,c,b){c=r(c,b);b=!t(a)&&f.keys(a);for(var g=(b||a).length,d=Array(g),e=0;g>e;e++){var h=b?b[e]:e;d[e]=c(a[h],h,a)}return d};
f.reduce=f.foldl=f.inject=e(1);f.reduceRight=f.foldr=e(-1);f.find=f.detect=function(a,c,b){var g;return g=t(a)?f.findIndex(a,c,b):f.findKey(a,c,b),void 0!==g&&-1!==g?a[g]:void 0};f.filter=f.select=function(a,c,b){var g=[];return c=r(c,b),f.each(a,function(a,b,u){c(a,b,u)&&g.push(a)}),g};f.reject=function(a,c,b){return f.filter(a,f.negate(r(c)),b)};f.every=f.all=function(a,c,b){c=r(c,b);b=!t(a)&&f.keys(a);for(var g=(b||a).length,d=0;g>d;d++){var e=b?b[d]:d;if(!c(a[e],e,a))return!1}return!0};f.some=
f.any=function(a,c,b){c=r(c,b);b=!t(a)&&f.keys(a);for(var g=(b||a).length,d=0;g>d;d++){var e=b?b[d]:d;if(c(a[e],e,a))return!0}return!1};f.contains=f.includes=f.include=function(a,c,b,g){return t(a)||(a=f.values(a)),("number"!=typeof b||g)&&(b=0),0<=f.indexOf(a,c,b)};f.invoke=function(a,c){var b=k.call(arguments,2),g=f.isFunction(c);return f.map(a,function(a){var u=g?c:a[c];return null==u?u:u.apply(a,b)})};f.pluck=function(a,c){return f.map(a,f.property(c))};f.where=function(a,c){return f.filter(a,
f.matcher(c))};f.findWhere=function(a,c){return f.find(a,f.matcher(c))};f.max=function(a,c,b){var g,d=-1/0,e=-1/0;if(null==c&&null!=a){a=t(a)?a:f.values(a);for(var h=0,k=a.length;k>h;h++)b=a[h],b>d&&(d=b)}else c=r(c,b),f.each(a,function(a,b,u){g=c(a,b,u);(g>e||g===-1/0&&d===-1/0)&&(d=a,e=g)});return d};f.min=function(a,c,b){var g,d=1/0,e=1/0;if(null==c&&null!=a){a=t(a)?a:f.values(a);for(var h=0,k=a.length;k>h;h++)b=a[h],d>b&&(d=b)}else c=r(c,b),f.each(a,function(a,b,u){g=c(a,b,u);(e>g||1/0===g&&1/
0===d)&&(d=a,e=g)});return d};f.shuffle=function(a){for(var c=t(a)?a:f.values(a),b=c.length,g=Array(b),d=0;b>d;d++)a=f.random(0,d),a!==d&&(g[d]=g[a]),g[a]=c[d];return g};f.sample=function(a,c,b){return null==c||b?(t(a)||(a=f.values(a)),a[f.random(a.length-1)]):f.shuffle(a).slice(0,Math.max(0,c))};f.sortBy=function(a,c,b){return c=r(c,b),f.pluck(f.map(a,function(a,b,g){return{value:a,index:b,criteria:c(a,b,g)}}).sort(function(a,c){var b=a.criteria,g=c.criteria;if(b!==g){if(b>g||void 0===b)return 1;
if(g>b||void 0===g)return-1}return a.index-c.index}),"value")};var D=function(a){return function(c,b,g){var d={};return b=r(b,g),f.each(c,function(g,f){var e=b(g,f,c);a(d,g,e)}),d}};f.groupBy=D(function(a,c,b){f.has(a,b)?a[b].push(c):a[b]=[c]});f.indexBy=D(function(a,c,b){a[b]=c});f.countBy=D(function(a,c,b){f.has(a,b)?a[b]++:a[b]=1});f.toArray=function(a){return a?f.isArray(a)?k.call(a):t(a)?f.map(a,f.identity):f.values(a):[]};f.size=function(a){return null==a?0:t(a)?a.length:f.keys(a).length};f.partition=
function(a,c,b){c=r(c,b);var g=[],d=[];return f.each(a,function(a,b,f){(c(a,b,f)?g:d).push(a)}),[g,d]};f.first=f.head=f.take=function(a,c,b){return null==a?void 0:null==c||b?a[0]:f.initial(a,a.length-c)};f.initial=function(a,c,b){return k.call(a,0,Math.max(0,a.length-(null==c||b?1:c)))};f.last=function(a,c,b){return null==a?void 0:null==c||b?a[a.length-1]:f.rest(a,Math.max(0,a.length-c))};f.rest=f.tail=f.drop=function(a,c,b){return k.call(a,null==c||b?1:c)};f.compact=function(a){return f.filter(a,
f.identity)};var w=function(a,c,b,g){var d=[],e=0;g=g||0;for(var h=v(a);h>g;g++){var k=a[g];if(t(k)&&(f.isArray(k)||f.isArguments(k))){c||(k=w(k,c,b));var n=0,l=k.length;for(d.length+=l;l>n;)d[e++]=k[n++]}else b||(d[e++]=k)}return d};f.flatten=function(a,c){return w(a,c,!1)};f.without=function(a){return f.difference(a,k.call(arguments,1))};f.uniq=f.unique=function(a,c,b,g){f.isBoolean(c)||(g=b,b=c,c=!1);null!=b&&(b=r(b,g));g=[];for(var d=[],e=0,h=v(a);h>e;e++){var k=a[e],n=b?b(k,e,a):k;c?(e&&d===
n||g.push(k),d=n):b?f.contains(d,n)||(d.push(n),g.push(k)):f.contains(g,k)||g.push(k)}return g};f.union=function(){return f.uniq(w(arguments,!0,!0))};f.intersection=function(a){for(var c=[],b=arguments.length,g=0,d=v(a);d>g;g++){var e=a[g];if(!f.contains(c,e)){for(var k=1;b>k&&f.contains(arguments[k],e);k++);k===b&&c.push(e)}}return c};f.difference=function(a){var c=w(arguments,!0,!0,1);return f.filter(a,function(a){return!f.contains(c,a)})};f.zip=function(){return f.unzip(arguments)};f.unzip=function(a){for(var c=
a&&f.max(a,v).length||0,b=Array(c),g=0;c>g;g++)b[g]=f.pluck(a,g);return b};f.object=function(a,c){for(var b={},g=0,f=v(a);f>g;g++)c?b[a[g]]=c[g]:b[a[g][0]]=a[g][1];return b};f.findIndex=l(1);f.findLastIndex=l(-1);f.sortedIndex=function(a,c,b,g){b=r(b,g,1);c=b(c);g=0;for(var f=v(a);f>g;){var d=Math.floor((g+f)/2);b(a[d])<c?g=d+1:f=d}return g};f.indexOf=m(1,f.findIndex,f.sortedIndex);f.lastIndexOf=m(-1,f.findLastIndex);f.range=function(a,c,b){null==c&&(c=a||0,a=0);b=b||1;c=Math.max(Math.ceil((c-a)/
b),0);for(var g=Array(c),f=0;c>f;f++,a+=b)g[f]=a;return g};var K=function(a,c,b,g,d){if(!(g instanceof c))return a.apply(b,d);c=J(a.prototype);a=a.apply(c,d);return f.isObject(a)?a:c};f.bind=function(a,c){if(B&&a.bind===B)return B.apply(a,k.call(arguments,1));if(!f.isFunction(a))throw new TypeError("Bind must be called on a function");var b=k.call(arguments,2),g=function(){return K(a,g,c,this,b.concat(k.call(arguments)))};return g};f.partial=function(a){var c=k.call(arguments,1),b=function(){for(var g=
0,d=c.length,e=Array(d),k=0;d>k;k++)e[k]=c[k]===f?arguments[g++]:c[k];for(;g<arguments.length;)e.push(arguments[g++]);return K(a,b,this,this,e)};return b};f.bindAll=function(a){var c,b,g=arguments.length;if(1>=g)throw Error("bindAll must be passed function names");for(c=1;g>c;c++)b=arguments[c],a[b]=f.bind(a[b],a);return a};f.memoize=function(a,c){var b=function(g){var d=b.cache,e=""+(c?c.apply(this,arguments):g);return f.has(d,e)||(d[e]=a.apply(this,arguments)),d[e]};return b.cache={},b};f.delay=
function(a,c){var b=k.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},c)};f.defer=f.partial(f.delay,f,1);f.throttle=function(a,c,b){var g,d,e,k=null,h=0;b||(b={});var n=function(){h=!1===b.leading?0:f.now();k=null;e=a.apply(g,d);k||(g=d=null)};return function(){var l=f.now();h||!1!==b.leading||(h=l);var m=c-(l-h);return g=this,d=arguments,0>=m||m>c?(k&&(clearTimeout(k),k=null),h=l,e=a.apply(g,d),k||(g=d=null)):k||!1===b.trailing||(k=setTimeout(n,m)),e}};f.debounce=function(a,
c,b){var g,d,e,k,h,n=function(){var l=f.now()-k;c>l&&0<=l?g=setTimeout(n,c-l):(g=null,b||(h=a.apply(e,d),g||(e=d=null)))};return function(){e=this;d=arguments;k=f.now();var l=b&&!g;return g||(g=setTimeout(n,c)),l&&(h=a.apply(e,d),e=d=null),h}};f.wrap=function(a,c){return f.partial(c,a)};f.negate=function(a){return function(){return!a.apply(this,arguments)}};f.compose=function(){var a=arguments,c=a.length-1;return function(){for(var b=c,g=a[c].apply(this,arguments);b--;)g=a[b].call(this,g);return g}};
f.after=function(a,c){return function(){return 1>--a?c.apply(this,arguments):void 0}};f.before=function(a,c){var b;return function(){return 0<--a&&(b=c.apply(this,arguments)),1>=a&&(c=null),b}};f.once=f.partial(f.before,2);var L=!{toString:null}.propertyIsEnumerable("toString"),H="valueOf isPrototypeOf toString propertyIsEnumerable hasOwnProperty toLocaleString".split(" ");f.keys=function(a){if(!f.isObject(a))return[];if(y)return y(a);var c=[],b;for(b in a)f.has(a,b)&&c.push(b);return L&&h(a,c),c};
f.allKeys=function(a){if(!f.isObject(a))return[];var c=[],b;for(b in a)c.push(b);return L&&h(a,c),c};f.values=function(a){for(var c=f.keys(a),b=c.length,g=Array(b),d=0;b>d;d++)g[d]=a[c[d]];return g};f.mapObject=function(a,c,b){c=r(c,b);for(var g=f.keys(a),d=g.length,e={},k=0;d>k;k++)b=g[k],e[b]=c(a[b],b,a);return e};f.pairs=function(a){for(var c=f.keys(a),b=c.length,g=Array(b),d=0;b>d;d++)g[d]=[c[d],a[c[d]]];return g};f.invert=function(a){for(var c={},b=f.keys(a),g=0,d=b.length;d>g;g++)c[a[b[g]]]=
b[g];return c};f.functions=f.methods=function(a){var c=[],b;for(b in a)f.isFunction(a[b])&&c.push(b);return c.sort()};f.extend=z(f.allKeys);f.extendOwn=f.assign=z(f.keys);f.findKey=function(a,c,b){c=r(c,b);var g;b=f.keys(a);for(var d=0,e=b.length;e>d;d++)if(g=b[d],c(a[g],g,a))return g};f.pick=function(a,c,b){var g,d,e={},k=a;if(null==k)return e;f.isFunction(c)?(d=f.allKeys(k),g=x(c,b)):(d=w(arguments,!1,!1,1),g=function(a,c,b){return c in b},k=Object(k));for(var h=0,n=d.length;n>h;h++){var l=d[h],
m=k[l];g(m,l,k)&&(e[l]=m)}return e};f.omit=function(a,c,b){if(f.isFunction(c))c=f.negate(c);else{var g=f.map(w(arguments,!1,!1,1),String);c=function(a,c){return!f.contains(g,c)}}return f.pick(a,c,b)};f.defaults=z(f.allKeys,!0);f.create=function(a,c){var b=J(a);return c&&f.extendOwn(b,c),b};f.clone=function(a){return f.isObject(a)?f.isArray(a)?a.slice():f.extend({},a):a};f.tap=function(a,c){return c(a),a};f.isMatch=function(a,c){var b=f.keys(c),g=b.length;if(null==a)return!g;for(var d=Object(a),e=
0;g>e;e++){var k=b[e];if(c[k]!==d[k]||!(k in d))return!1}return!0};var E=function(a,c,b,g){if(a===c)return 0!==a||1/a===1/c;if(null==a||null==c)return a===c;a instanceof f&&(a=a._wrapped);c instanceof f&&(c=c._wrapped);var d=n.call(a);if(d!==n.call(c))return!1;switch(d){case "[object RegExp]":case "[object String]":return""+a==""+c;case "[object Number]":return+a!==+a?+c!==+c:0===+a?1/+a===1/c:+a===+c;case "[object Date]":case "[object Boolean]":return+a===+c}d="[object Array]"===d;if(!d){if("object"!=
typeof a||"object"!=typeof c)return!1;var e=a.constructor,k=c.constructor;if(e!==k&&!(f.isFunction(e)&&e instanceof e&&f.isFunction(k)&&k instanceof k)&&"constructor"in a&&"constructor"in c)return!1}b=b||[];g=g||[];for(e=b.length;e--;)if(b[e]===a)return g[e]===c;if(b.push(a),g.push(c),d){if(e=a.length,e!==c.length)return!1;for(;e--;)if(!E(a[e],c[e],b,g))return!1}else{var h,d=f.keys(a);if(e=d.length,f.keys(c).length!==e)return!1;for(;e--;)if(h=d[e],!f.has(c,h)||!E(a[h],c[h],b,g))return!1}return b.pop(),
g.pop(),!0};f.isEqual=function(a,c){return E(a,c)};f.isEmpty=function(a){return null==a?!0:t(a)&&(f.isArray(a)||f.isString(a)||f.isArguments(a))?0===a.length:0===f.keys(a).length};f.isElement=function(a){return!(!a||1!==a.nodeType)};f.isArray=q||function(a){return"[object Array]"===n.call(a)};f.isObject=function(a){var c=typeof a;return"function"===c||"object"===c&&!!a};f.each("Arguments Function String Number Date RegExp Error".split(" "),function(a){f["is"+a]=function(c){return n.call(c)==="[object "+
a+"]"}});f.isArguments(arguments)||(f.isArguments=function(a){return f.has(a,"callee")});"function"!=typeof/./&&"object"!=typeof Int8Array&&(f.isFunction=function(a){return"function"==typeof a||!1});f.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};f.isNaN=function(a){return f.isNumber(a)&&a!==+a};f.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"===n.call(a)};f.isNull=function(a){return null===a};f.isUndefined=function(a){return void 0===a};f.has=function(a,c){return null!=
a&&p.call(a,c)};f.noConflict=function(){return d._=b,this};f.identity=function(a){return a};f.constant=function(a){return function(){return a}};f.noop=function(){};f.property=A;f.propertyOf=function(a){return null==a?function(){}:function(c){return a[c]}};f.matcher=f.matches=function(a){return a=f.extendOwn({},a),function(c){return f.isMatch(c,a)}};f.times=function(a,c,b){var g=Array(Math.max(0,a));c=x(c,b,1);for(b=0;a>b;b++)g[b]=c(b);return g};f.random=function(a,c){return null==c&&(c=a,a=0),a+Math.floor(Math.random()*
(c-a+1))};f.now=Date.now||function(){return(new Date).getTime()};q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};z=f.invert(q);A=function(a){var c=function(c){return a[c]},b="(?:"+f.keys(a).join("|")+")",g=RegExp(b),d=RegExp(b,"g");return function(a){return a=null==a?"":""+a,g.test(a)?a.replace(d,c):a}};f.escape=A(q);f.unescape=A(z);f.result=function(a,c,b){c=null==a?void 0:a[c];return void 0===c&&(c=b),f.isFunction(c)?c.call(a):c};var O=0;f.uniqueId=function(a){var c=
++O+"";return a?a+c:c};f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Q=/\\|'|\r|\n|\u2028|\u2029/g,R=function(a){return"\\"+P[a]};f.template=function(a,c,b){!c&&b&&(c=b);c=f.defaults({},c,f.templateSettings);b=RegExp([(c.escape||F).source,(c.interpolate||F).source,(c.evaluate||F).source].join("|")+"|$","g");var g=0,d="__p+='";a.replace(b,function(c,b,f,
e,k){return d+=a.slice(g,k).replace(Q,R),g=k+c.length,b?d+="'+\n((__t=("+b+"))==null?'':_.escape(__t))+\n'":f?d+="'+\n((__t=("+f+"))==null?'':__t)+\n'":e&&(d+="';\n"+e+"\n__p+='"),c});d+="';\n";c.variable||(d="with(obj||{}){\n"+d+"}\n");d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{var e=new Function(c.variable||"obj","_",d)}catch(k){throw k.source=d,k;}b=function(a){return e.call(this,a,f)};return b.source="function("+(c.variable||
"obj")+"){\n"+d+"}",b};f.chain=function(a){a=f(a);return a._chain=!0,a};var G=function(a,c){return a._chain?f(c).chain():c};f.mixin=function(a){f.each(f.functions(a),function(c){var b=f[c]=a[c];f.prototype[c]=function(){var a=[this._wrapped];return g.apply(a,arguments),G(this,b.apply(f,a))}})};f.mixin(f);f.each("pop push reverse shift sort splice unshift".split(" "),function(c){var b=a[c];f.prototype[c]=function(){var a=this._wrapped;return b.apply(a,arguments),"shift"!==c&&"splice"!==c||0!==a.length||
delete a[0],G(this,a)}});f.each(["concat","join","slice"],function(c){var b=a[c];f.prototype[c]=function(){return G(this,b.apply(this._wrapped,arguments))}});f.prototype.value=function(){return this._wrapped};f.prototype.valueOf=f.prototype.toJSON=f.prototype.value;f.prototype.toString=function(){return""+this._wrapped};"function"==typeof define&&define.amd&&define("underscore",[],function(){return f})}).call(this);
function Sanitize(e){var l;l=e||{};this.config={};this.config.elements=l.elements?l.elements:[];this.config.attributes=l.attributes?l.attributes:{};this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[];this.config.allow_comments=l.allow_comments?l.allow_comments:!1;this.allowed_elements={};this.config.protocols=l.protocols?l.protocols:{};this.config.add_attributes=l.add_attributes?l.add_attributes:{};this.dom=l.dom?l.dom:document;for(e=0;e<
this.config.elements.length;e++)this.allowed_elements[this.config.elements[e]]=!0;this.config.remove_element_contents={};this.config.remove_all_contents=!1;if(l.remove_contents)if(l.remove_contents instanceof Array)for(e=0;e<l.remove_contents.length;e++)this.config.remove_element_contents[l.remove_contents[e]]=!0;else this.config.remove_all_contents=!0;this.transformers=l.transformers?l.transformers:[]}Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i;
Sanitize.RELATIVE="__RELATIVE__";Sanitize.ALL="__ALL__";
Sanitize.prototype.clean_node=function(e){function l(b,a){var c;for(c=0;c<a.length;c++)if(a[c]==b)return c;return-1}function m(){var b=[],a={},c,g;for(c=0;c<arguments.length;c++)if(arguments[c]&&arguments[c].length)for(g=0;g<arguments[c].length;g++)a[arguments[c][g]]||(a[arguments[c][g]]=!0,b.push(arguments[c][g]));return b}function h(b){var a;switch(b.nodeType){case 1:var c,g,d,e,p,q,y;c=[];g=b;e=!1;for(d=0;d<this.transformers.length;d++)if(p=this.transformers[d]({allowed_elements:this.allowed_elements,
config:this.config,node:b,node_name:b.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!=p)if("object"==typeof p){if(p.whitelist_nodes&&p.whitelist_nodes instanceof Array)for(e=0;e<p.whitelist_nodes.length;e++)-1==l(p.whitelist_nodes[e],this.whitelist_nodes)&&this.whitelist_nodes.push(p.whitelist_nodes[e]);e=p.whitelist?!0:!1;p.attr_whitelist&&(c=m(c,p.attr_whitelist));g=p.node?p.node:g}else throw Error("transformer output must be an object or null");b=g;d=b.nodeName.toLowerCase();
g=this.current_element;if(this.allowed_elements[d]||e){this.current_element=this.dom.createElement(b.nodeName);g.appendChild(this.current_element);e=this.config.attributes;e=m(e[d],e[Sanitize.ALL],c);for(c=0;c<e.length;c++)if(a=e[c],p=b.attributes[a])q=!0,this.config.protocols[d]&&this.config.protocols[d][a]&&(q=this.config.protocols[d][a],q=(y=p.value.toLowerCase().match(Sanitize.REGEX_PROTOCOL))?-1!=l(y[1],q):-1!=l(Sanitize.RELATIVE,q)),q&&(q=document.createAttribute(a),q.value=p.value,this.current_element.setAttributeNode(q));
if(this.config.add_attributes[d])for(a in this.config.add_attributes[d])q=document.createAttribute(a),q.value=this.config.add_attributes[d][a],this.current_element.setAttributeNode(q)}else if(-1!=l(b,this.whitelist_nodes)){for(this.current_element=b.cloneNode(!0);0<this.current_element.childNodes.length;)this.current_element.removeChild(this.current_element.firstChild);g.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[d])for(c=0;c<b.childNodes.length;c++)h.call(this,
b.childNodes[c]);this.current_element.normalize&&this.current_element.normalize();this.current_element=g;break;case 3:a=b.cloneNode(!1);this.current_element.appendChild(a);break;case 5:a=b.cloneNode(!1);this.current_element.appendChild(a);break;case 8:this.config.allow_comments&&(a=b.cloneNode(!1),this.current_element.appendChild(a));break;default:console&&console.log&&console.log("unknown node type",b.nodeType)}}var d=this.dom.createDocumentFragment();this.current_element=d;this.whitelist_nodes=
[];for(i=0;i<e.childNodes.length;i++)h.call(this,e.childNodes[i]);d.normalize&&d.normalize();return d};"function"===typeof define&&define("sanitize",[],function(){return Sanitize});(function(){window.Dante={Editor:{ToolTip:{},PopOver:{},Menu:{}},defaults:{image_placeholder:"../images/dante/media-loading-placeholder.png"},version:"0.0.13"}}).call(this);
(function(){var e,l,m;String.prototype.killWhiteSpace=function(){return this.replace(/\s/g,"")};String.prototype.reduceWhiteSpace=function(){return this.replace(/\s+/g," ")};m={};window.Dante.utils=m;m.log=function(e,d){if(window.debugMode||d)return console.log(e)};m.getBase64Image=function(e){var d;d=document.createElement("canvas");d.width=e.width;d.height=e.height;d.getContext("2d").drawImage(e,0,0);return d.toDataURL("image/png")};m.generateUniqueName=function(){return Math.random().toString(36).slice(8)};
m.saveSelection=function(){var e,d,b,a;if(window.getSelection){if(a=window.getSelection(),a.getRangeAt&&a.rangeCount){b=[];e=0;for(d=a.rangeCount;e<d;)b.push(a.getRangeAt(e)),++e;return b}}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null};m.restoreSelection=function(e){var d,b,a;if(e)if(window.getSelection)for(a=window.getSelection(),a.removeAllRanges(),d=0,b=e.length;d<b;)a.addRange(e[d]),++d;else document.selection&&e.select&&e.select()};
m.getNode=function(){var e,d;e=void 0;if(document.selection&&document.selection.createRange)return e=document.selection.createRange(),e.parentElement();if(window.getSelection&&(d=window.getSelection(),d.getRangeAt?0<d.rangeCount&&(e=d.getRangeAt(0)):(e=document.createRange(),e.setStart(d.anchorNode,d.anchorOffset),e.setEnd(d.focusNode,d.focusOffset),e.collapsed!==d.isCollapsed&&(e.setStart(d.focusNode,d.focusOffset),e.setEnd(d.anchorNode,d.anchorOffset))),e))return e=e.commonAncestorContainer,3===
e.nodeType?e.parentNode:e};m.getSelectionDimensions=function(){var e,d,b,a;d=document.selection;e=a=0;d?"Control"!==d.type&&(d=d.createRange(),a=d.boundingWidth,e=d.boundingHeight):window.getSelection&&(d=window.getSelection(),d.rangeCount&&(d=d.getRangeAt(0).cloneRange(),d.getBoundingClientRect&&(b=d.getBoundingClientRect(),a=b.right-b.left,e=b.bottom-b.top)));return{width:a,height:e,top:b.top,left:b.left}};m.getCaretPosition=function(e){var d,b;d=0;window.getSelection?(b=window.getSelection(),b.rangeCount&&
(b=b.getRangeAt(0),b.commonAncestorContainer.parentNode===e&&(d=b.endOffset))):document.selection&&document.selection.createRange&&(b=document.selection.createRange(),b.parentElement()===e&&(d=document.createElement("span"),e.insertBefore(d,e.firstChild),e=b.duplicate(),e.moveToElementText(d),e.setEndPoint("EndToEnd",b),d=e.text.length));return d};m.isElementInViewport=function(e){"function"===typeof jQuery&&e instanceof jQuery&&(e=e[0]);e=e.getBoundingClientRect();return 0<=e.top&&0<=e.left&&e.bottom<=
(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)};l=function(e,d){var b;b=document.createRange();b.selectNodeContents(e);b.setEnd(d.startContainer,d.startOffset);return 0===b.toString().trim().length};e=function(e,d){var b;b=document.createRange();b.selectNodeContents(e);b.setStart(d.endContainer,d.endOffset);return 0===b.toString().trim().length};$.fn.editableIsCaret=function(){return"Caret"===window.getSelection().type};
$.fn.editableRange=function(){var e;e=window.getSelection();if(0<e.rangeCount)return e.getRangeAt(0)};$.fn.editableCaretRange=function(){if(this.editableIsCaret())return this.editableRange()};$.fn.editableSetRange=function(e){var d;d=window.getSelection();0<d.rangeCount&&d.removeAllRanges();return d.addRange(e)};$.fn.editableFocus=function(e){var d,b;null==e&&(e=!0);if(this.attr("contenteditable"))return b=window.getSelection(),0<b.rangeCount&&b.removeAllRanges(),d=document.createRange(),d.selectNodeContents(this[0]),
d.collapse(e),b.addRange(d)};$.fn.editableCaretAtStart=function(){var e;return(e=this.editableRange())?l(this[0],e):!1};$.fn.editableCaretAtEnd=function(){var h;return(h=this.editableRange())?e(this[0],h):!1};$.fn.editableCaretOnFirstLine=function(){var h,d;h=this.editableRange();if(!h)return!1;if(l(this[0],h))return!0;h=e(this[0],h)?this[0].getBoundingClientRect().bottom-20:h.getClientRects()[0].top;d=this[0].getBoundingClientRect().top;return h<d+20};$.fn.editableCaretOnLastLine=function(){var h,
d;h=this.editableRange();if(!h)return!1;if(e(this[0],h))return!0;h=l(this[0],h)?this[0].getBoundingClientRect().top+20:h.getClientRects()[0].bottom;d=this[0].getBoundingClientRect().bottom;return h>d-20};$.fn.exists=function(){return 0<this.length}}).call(this);
(function(){Dante.View=function(){function e(e){null==e&&(e={});e.el&&(this.el=e.el);this._ensureElement();this.initialize.apply(this,arguments);this._ensureEvents()}e.prototype.initialize=function(e){};e.prototype.events=function(){};e.prototype.render=function(){return this};e.prototype.remove=function(){this._removeElement();this.stopListening();return this};e.prototype._removeElement=function(){return this.$el.remove()};e.prototype.setElement=function(e){this._setElement(e);return this};e.prototype.setEvent=
function(e){if(!_.isEmpty(e))return _.each(e,function(e){return function(h,d){var b,a,c;c=d.split(" ");if(_.isFunction(h))a=h;else if(_.isString(h))a=e[h];else throw"error event needs a function or string";b=1<c.length?c.splice(1,3).join(" "):null;return $(e.el).on(c[0],b,_.bind(a,e))}}(this))};e.prototype._ensureElement=function(){return this.setElement(_.result(this,"el"))};e.prototype._ensureEvents=function(){return this.setEvent(_.result(this,"events"))};e.prototype._setElement=function(e){this.$el=
e instanceof $?e:$(e);return this.el=this.$el[0]};return e}();Dante.View.extend=function(e,l){var m,h,d;d=this;h=void 0;h=e&&_.has(e,"constructor")?e.constructor:function(){return d.apply(this,arguments)};_.extend(h,d,l);m=function(){this.constructor=h};m.prototype=d.prototype;h.prototype=new m;e&&_.extend(h.prototype,e);h.__super__=d.prototype;return h}}).call(this);
(function(){var e,l=function(e,b){return function(){return e.apply(b,arguments)}},m={}.hasOwnProperty,h=function(e,b){function a(){this.constructor=e}for(var c in b)m.call(b,c)&&(e[c]=b[c]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e};e=Dante.utils;Dante.Editor=function(d){function b(){this.setupFirstAndLast=l(this.setupFirstAndLast,this);this.addClassesToElement=l(this.addClassesToElement,this);this.handlePaste=l(this.handlePaste,this);this.handleArrowForKeyDown=l(this.handleArrowForKeyDown,
this);this.handleArrow=l(this.handleArrow,this);this.handleMouseUp=l(this.handleMouseUp,this);this.selection=l(this.selection,this);this.render=l(this.render,this);this.restart=l(this.restart,this);this.start=l(this.start,this);this.appendInitialContent=l(this.appendInitialContent,this);this.appendMenus=l(this.appendMenus,this);this.template=l(this.template,this);this.initialize=l(this.initialize,this);return b.__super__.constructor.apply(this,arguments)}h(b,d);b.prototype.events={mouseup:"handleMouseUp",
keydown:"handleKeyDown",keyup:"handleKeyUp",paste:"handlePaste",dblclick:"handleDblclick",dragstart:"handleDrag",drop:"handleDrag","click .graf--figure .aspectRatioPlaceholder":"handleGrafFigureSelectImg","click .graf--figure figcaption":"handleGrafFigureSelectCaption","mouseover .graf--figure.graf--iframe":"handleGrafFigureSelectIframe","mouseleave .graf--figure.graf--iframe":"handleGrafFigureUnSelectIframe","keyup .graf--figure figcaption":"handleGrafCaptionTyping","mouseover .markup--anchor":"displayPopOver",
"mouseout  .markup--anchor":"hidePopOver"};b.prototype.initialize=function(a){null==a&&(a={});this.editor_options=a;this.initial_html=$(this.el).html();this.current_node=this.current_range=null;this.el=a.el||"#editor";this.upload_url=a.upload_url||"/uploads.json";this.upload_callback=a.upload_callback;this.oembed_url=a.oembed_url||"http://api.embed.ly/1/oembed?url=";this.extract_url=a.extract_url||"http://api.embed.ly/1/extract?key=86c28a410a104c8bb58848733c82f840&url=";this.default_loading_placeholder=
a.default_loading_placeholder||Dante.defaults.image_placeholder;this.store_url=a.store_url;this.store_method=a.store_method||"POST";this.spell_check=a.spellcheck||!1;this.disable_title=a.disable_title||!1;this.store_interval=a.store_interval||15E3;this.paste_element_id="#dante-paste-div";this.tooltip_class=a.tooltip_class||Dante.Editor.Tooltip;a.base_widgets||(a.base_widgets=["uploader","embed","embed_extract"]);this.widgets=[];window.debugMode=a.debug||!1;window.debugMode&&$(this.el).addClass("debug");
localStorage.getItem("contenteditable")&&$(this.el).html(localStorage.getItem("contenteditable"));this.store();this.title_placeholder="<span class='defaultValue defaultValue--root'>"+(a.title_placeholder||"Title")+"</span><br>";this.title=a.title||"";this.body_placeholder="<span class='defaultValue defaultValue--root'>"+(a.body_placeholder||"Tell your story\u2026")+"</span><br>";this.embed_placeholder="<span class='defaultValue defaultValue--root'>"+(a.embed_placeholder||"Paste a YouTube, Vine, Vimeo, or other video link, and press Enter")+
"</span><br>";this.extract_placeholder="<span class='defaultValue defaultValue--root'>"+(a.extract_placeholder||"Paste a link to embed content from another site (e.g. Twitter) and press Enter")+"</span><br>";return this.initializeWidgets(a)};b.prototype.initializeWidgets=function(a){var c,b;c=a.base_widgets;b=this;0<=c.indexOf("uploader")&&(this.uploader_widget=new Dante.View.TooltipWidget.Uploader({current_editor:this}),this.widgets.push(this.uploader_widget));0<=c.indexOf("embed")&&(this.embed_widget=
new Dante.View.TooltipWidget.Embed({current_editor:this}),this.widgets.push(this.embed_widget));0<=c.indexOf("embed_extract")&&(this.embed_extract_widget=new Dante.View.TooltipWidget.EmbedExtract({current_editor:this}),this.widgets.push(this.embed_extract_widget));if(a.extra_tooltip_widgets)return _.each(a.extra_tooltip_widgets,function(a){return function(c){c.current_editor||(c.current_editor=b);return a.widgets.push(c)}}(this))};b.prototype.store=function(){if(this.store_url)return setTimeout(function(a){return function(){return a.checkforStore()}}(this),
this.store_interval)};b.prototype.checkforStore=function(){if(this.content===this.getContent())return e.log("content not changed skip store"),this.store();e.log("content changed! update");this.content=this.getContent();return $.ajax({url:this.store_url,method:this.store_method,data:{body:this.getContent()},success:function(a){e.log("store!");return e.log(a)},complete:function(a){return function(c){return a.store()}}(this)})};b.prototype.getContent=function(){return $(this.el).find(".section-inner").html()};
b.prototype.renderTitle=function(){return"<h3 class='graf graf--h3'>"+(0<this.title.length?this.title:this.title_placeholder)+"</h3>"};b.prototype.template=function(){return"<section class='section--first section--last'> <div class='section-divider layoutSingleColumn'> <hr class='section-divider'> </div> <div class='section-content'> <div class='section-inner layoutSingleColumn'> "+(this.disable_title?"":this.renderTitle())+" <p class='graf graf--p'>"+this.body_placeholder+"<p> </div> </div> </section>"};
b.prototype.baseParagraphTmpl=function(){return"<p class='graf--p' name='"+e.generateUniqueName()+"'><br></p>"};b.prototype.appendMenus=function(){$("<div id='dante-menu' class='dante-menu'></div>").insertAfter(this.el);$("<div class='inlineTooltip'></div>").insertAfter(this.el);this.editor_menu=new Dante.Editor.Menu({editor:this});this.tooltip_view=new this.tooltip_class({editor:this,widgets:this.widgets});this.pop_over=new Dante.Editor.PopOver({editor:this});this.pop_over.render().hide();return this.tooltip_view.render().hide()};
b.prototype.appendInitialContent=function(){$(this.el).find(".section-inner").html(this.initial_html);return $(this.el).attr("spellcheck",this.spell_check)};b.prototype.start=function(){this.render();$(this.el).attr("contenteditable","true");$(this.el).addClass("postField postField--body editable smart-media-plugin");$(this.el).wrap("<article class='postArticle'><div class='postContent'><div class='notesSource'></div></div></article>");this.appendMenus();_.isEmpty(this.initial_html.trim())||this.appendInitialContent();
return this.parseInitialMess()};b.prototype.restart=function(){return this.render()};b.prototype.render=function(){this.template();return $(this.el).html(this.template())};b.prototype.getSelectedText=function(){var a;a="";"undefined"!==typeof window.getSelection?a=window.getSelection().toString():"undefined"!==typeof document.selection&&"Text"===document.selection.type&&(a=document.selection.createRange().text);return a};b.prototype.selection=function(){a;var a;if(window.getSelection)return window.getSelection();
if(document.selection&&"Control"!==document.selection.type)return document.selection};b.prototype.getRange=function(){var a,c;a=$(this.el)[0];(c=selection&&selection.rangeCount&&selection.getRangeAt(0))||(c=document.createRange());a.contains(c.commonAncestorContainer)||(c.selectNodeContents(a),c.collapse(!1));return c};b.prototype.setRange=function(a){a=a||this.current_range;a||(a=this.getRange(),a.collapse(!1));this.selection().removeAllRanges();this.selection().addRange(a);return this};b.prototype.getCharacterPrecedingCaret=
function(){var a,c;a="";c=void 0;window.getSelection?(c=window.getSelection(),0<c.rangeCount&&(c=c.getRangeAt(0).cloneRange(),c.collapse(!0),c.setStart(this.getNode(),0),a=c.toString().slice(0))):(c=document.selection)&&"Control"!==c.type&&(c=c.createRange(),a=c.duplicate(),a.moveToElementText(containerEl),a.setEndPoint("EndToStart",c),a=a.text.slice(0));return a};b.prototype.isLastChar=function(){return $(this.getNode()).text().trim().length===this.getCharacterPrecedingCaret().trim().length};b.prototype.isFirstChar=
function(){return 0===this.getCharacterPrecedingCaret().trim().length};b.prototype.isSelectingAll=function(a){var c;c=this.getSelectedText().killWhiteSpace().length;a=$(a).text().killWhiteSpace().length;return c===a};b.prototype.setRangeAt=function(a,c){var b,e;null==c&&(c=0);b=document.createRange();e=window.getSelection();b.setStart(a,c);b.collapse(!0);e.removeAllRanges();e.addRange(b);return a.focus()};b.prototype.setRangeAtText=function(a,c){var b,e,d;e=document.createRange();d=window.getSelection();
b=a.firstChild;e.setStart(b,0);e.setEnd(b,0);e.collapse(!0);d.removeAllRanges();d.addRange(e);return a.focus()};b.prototype.focus=function(a){a||this.setRange();$(this.el).focus();return this};b.prototype.focusNode=function(a,c){c.setStartAfter(a);c.setEndBefore(a);c.collapse(!1);return this.setRange(c)};b.prototype.getNode=function(){var a,c;c=$(this.el).find(".section-inner")[0];if(!(1>this.selection().rangeCount)){a=this.selection().getRangeAt(0);a=a.commonAncestorContainer;if(!a||a===c)return null;
for(;a&&(1!==a.nodeType||!$(a).hasClass("graf"))&&a.parentNode!==c;)a=a.parentNode;if(!$(a).hasClass("graf--li"))for(;a&&a.parentNode!==c;)a=a.parentNode;return c&&c.contains(a)?a:null}};b.prototype.displayMenu=function(a){return setTimeout(function(a){return function(){var b;a.editor_menu.render();b=e.getSelectionDimensions();a.relocateMenu(b);return a.editor_menu.show()}}(this),10)};b.prototype.handleDrag=function(){return!1};b.prototype.handleGrafCaptionTyping=function(a){return _.isEmpty(e.getNode().textContent.trim())?
$(this.getNode()).addClass("is-defaultValue"):$(this.getNode()).removeClass("is-defaultValue")};b.prototype.handleTextSelection=function(a){var c;this.editor_menu.hide();c=this.getSelectedText();if(!$(a).is(".graf--mixtapeEmbed, .graf--figure")&&!_.isEmpty(c.trim()))return this.current_node=a,this.displayMenu()};b.prototype.relocateMenu=function(a){var c,b;c=this.editor_menu.$el.outerHeight();b=this.editor_menu.$el.width()/2;c=a.top+$(window).scrollTop()-c;return this.editor_menu.$el.offset({left:a.left+
a.width/2-b,top:c})};b.prototype.hidePlaceholder=function(a){return $(a).find("span.defaultValue").remove().html("<br>")};b.prototype.displayEmptyPlaceholder=function(a){$(".graf--first").html(this.title_placeholder);return $(".graf--last").html(this.body_placeholder)};b.prototype.displayPopOver=function(a){return this.pop_over.displayAt(a)};b.prototype.hidePopOver=function(a){return this.pop_over.hide(a)};b.prototype.handleGrafFigureSelectImg=function(a){e.log("FIGURE SELECT");a=a.currentTarget;
this.markAsSelected(a);$(a).parent(".graf--figure").addClass("is-selected is-mediaFocused");return this.selection().removeAllRanges()};b.prototype.handleGrafFigureSelectIframe=function(a){e.log("FIGURE IFRAME SELECT");this.iframeSelected=a=a.currentTarget;this.markAsSelected(a);$(a).addClass("is-selected is-mediaFocused");return this.selection().removeAllRanges()};b.prototype.handleGrafFigureUnSelectIframe=function(a){e.log("FIGURE IFRAME UNSELECT");a=a.currentTarget;this.iframeSelected=null;return $(a).removeClass("is-selected is-mediaFocused")};
b.prototype.handleGrafFigureSelectCaption=function(a){e.log("FIGCAPTION");return $(a.currentTarget).parent(".graf--figure").removeClass("is-mediaFocused")};b.prototype.handleMouseUp=function(a){e.log("MOUSE UP");a=this.getNode();if(!_.isNull(a))return this.prev_current_node=a,this.handleTextSelection(a),this.hidePlaceholder(a),this.markAsSelected(a),this.displayTooltipAt(a)};b.prototype.scrollTo=function(a){if(!e.isElementInViewport($(a)))return a=a.offset().top,$("html, body").animate({scrollTop:a},
20)};b.prototype.handleArrow=function(a){a=$(this.getNode());if(0<a.length)return this.markAsSelected(a),this.displayTooltipAt(a)};b.prototype.handleArrowForKeyDown=function(a){var c,b;c=this.getNode();b=$(c);e.log(a);a=a.originalEvent.key||a.originalEvent.keyIdentifier;e.log("ENTER ARROW for key "+a);switch(a){case "Down":(_.isUndefined(b)||!b.exists())&&$(".is-selected").exists()&&(b=$(".is-selected"));a=b.next();e.log("NEXT NODE IS "+a.attr("class"));e.log("CURRENT NODE IS "+b.attr("class"));if(!$(b).hasClass("graf"))break;
if(!b.hasClass("graf--figure")&&!$(b).editableCaretOnLastLine())break;e.log("ENTER ARROW PASSED RETURNS");if(a.hasClass("graf--figure")&&c)return b=a.find(".imageCaption"),this.scrollTo(b),e.log("1 down"),e.log(b[0]),this.skip_keyup=!0,this.selection().removeAllRanges(),this.markAsSelected(a),a.addClass("is-mediaFocused is-selected"),!1;if(a.hasClass("graf--mixtapeEmbed"))return b=b.next(".graf--mixtapeEmbed"),c=b[0].childNodes.length,this.setRangeAt(b[0],c),this.scrollTo(b),e.log("2 down"),!1;if(b.hasClass("graf--figure")&&
a.hasClass("graf"))return this.scrollTo(a),e.log("3 down, from figure to next graf"),this.markAsSelected(a),this.setRangeAt(a[0]),!1;break;case "Up":c=b.prev();e.log("PREV NODE IS "+c.attr("class"));e.log("CURRENT NODE IS up "+b.attr("class"));if(!$(b).hasClass("graf"))break;if(!$(b).editableCaretOnFirstLine())break;e.log("ENTER ARROW PASSED RETURNS");if(c.hasClass("graf--figure"))return e.log("1 up"),b=c.find(".imageCaption"),this.scrollTo(b),this.skip_keyup=!0,this.selection().removeAllRanges(),
this.markAsSelected(c),c.addClass("is-mediaFocused"),!1;if(c.hasClass("graf--mixtapeEmbed"))return b=b.prev(".graf--mixtapeEmbed"),c=b[0].childNodes.length,this.setRangeAt(b[0],c),this.scrollTo(b),e.log("2 up"),!1;if(b.hasClass("graf--figure")&&c.hasClass("graf"))return this.setRangeAt(c[0]),this.scrollTo(c),e.log("3 up"),!1;if(c.hasClass("graf"))return b=b.prev(".graf"),this.scrollTo(b),e.log("4 up"),this.skip_keyup=!0,this.markAsSelected(c),!1}};b.prototype.parseInitialMess=function(){return this.setupElementsClasses($(this.el).find(".section-inner"),
function(a){return function(){return a.handleUnwrappedImages($(a.el).find(".section-inner"))}}(this))};b.prototype.handleDblclick=function(){var a;e.log("handleDblclick");a=this.getNode();_.isNull(a)&&this.setRangeAt(this.prev_current_node);return!1};b.prototype.handlePaste=function(a){var c;e.log("pasted!");this.aa=this.getNode();c=void 0;window.clipboardData&&window.clipboardData.getData?c=window.clipboardData.getData("Text"):a.originalEvent.clipboardData&&a.originalEvent.clipboardData.getData&&
(a=a.originalEvent.clipboardData,c=_.isEmpty(a.getData("text/html"))?a.getData("text/plain"):a.getData("text/html"));e.log("Process and handle text...");if(c.match(/<\/*[a-z][^>]+?>/gi))return e.log("HTML DETECTED ON PASTE"),c=c.replace(/&.*;/g,""),c=c.replace(/<div>([\w\W]*?)<\/div>/gi,"<p>$1</p>"),document.body.appendChild($("<div id='"+this.paste_element_id.replace("#","")+"'></div>")[0]),$(this.paste_element_id).html("<span>"+c+"</span>"),this.setupElementsClasses($(this.paste_element_id),function(a){return function(){var c,
b,e;b=$($(a.paste_element_id).html()).insertAfter($(a.aa));$(a.paste_element_id).remove();c=b.last()[0];a.setRangeAt(c,c.childNodes.length);c=$(a.getNode());e=c.offset().top;a.markAsSelected(c);a.displayTooltipAt($(a.el).find(".is-selected"));a.handleUnwrappedImages(b);return $("html, body").animate({scrollTop:e},200)}}(this)),!1};b.prototype.handleUnwrappedImages=function(a){return _.each(a.find("img"),function(a){return function(b){e.log("process image here!");return a.uploader_widget.uploadExistentImage(b)}}(this))};
b.prototype.handleInmediateDeletion=function(a){this.inmediateDeletion=!1;$(this.baseParagraphTmpl()).insertBefore($(a)).addClass("is-selected");this.setRangeAt($(a).prev()[0]);return $(a).remove()};b.prototype.handleUnwrappedNode=function(a){var c;c=$(this.baseParagraphTmpl());this.setElementName(c);$(a).wrap(c);a=$("[name='"+c.attr("name")+"']");a.addClass("is-selected");this.setRangeAt(a[0]);return!1};b.prototype.handleNullAnchor=function(){var a,c,b;e.log("WARNING! this is an empty node");c=this.selection();
if(c.isCollapsed&&0<c.rangeCount)return a=c.getRangeAt(0),b=$(this.baseParagraphTmpl())[0],a.insertNode(b),a.setStart(b,0),a.setEnd(b,0),c.removeAllRanges(),c.addRange(a),a=$(a.commonAncestorContainer),b=a.prev(),c=b[0].childNodes.length,e.log(b),b.hasClass("graf")?(this.setRangeAt(b[0],c),a.remove(),this.markAsSelected(this.getNode())):b.hasClass("graf--mixtapeEmbed")?(this.setRangeAt(b[0],c),a.remove(),this.markAsSelected(this.getNode())):b||this.setRangeAt(this.$el.find(".section-inner p")[0]),
this.displayTooltipAt($(this.el).find(".is-selected"))};b.prototype.handleCompleteDeletion=function(a){if(_.isEmpty($(a).text().trim()))return e.log("HANDLE COMPLETE DELETION"),this.selection().removeAllRanges(),this.render(),setTimeout(function(a){return function(){return a.setRangeAt($(a.el).find(".section-inner p")[0])}}(this),20),this.completeDeletion=!0};b.prototype.handleTab=function(a){e.log("HANDLE TAB");a=$(a).next(".graf, .graf--mixtapeEmbed, .graf--figure, .graf--figure");if($(a).hasClass("graf--figure"))return a=
$(a).find("figcaption"),this.setRangeAt(a[0]),this.markAsSelected($(a).parent(".graf--figure")),this.displayTooltipAt(a),this.scrollTo($(a)),!1;if(_.isEmpty(a)||_.isUndefined(a[0]))a=$(".graf:first");this.setRangeAt(a[0]);this.markAsSelected(a);this.displayTooltipAt(a);return this.scrollTo($(a))};b.prototype.handleKeyDown=function(a){var c,b,d;e.log("KEYDOWN");c=this.getNode();d=$(c);c&&this.markAsSelected(c);if(9===a.which)return this.handleTab(c),!1;if(13===a.which){$(this.el).find(".is-selected").removeClass("is-selected");
e.log(this.isLastChar());d.hasClass("graf--p")?(b=this.handleSmartList(d,a))&&(c=b):d.hasClass("graf--li")&&this.handleListLineBreak(d,a);e.log("HANDLING WIDGET KEYDOWNS");_.each(this.widgets,function(c){return function(c){if(c.handleEnterKey)return c.handleEnterKey(a,d)}}(this));if(d.hasClass("graf--mixtapeEmbed")||d.hasClass("graf--iframe")||d.hasClass("graf--figure"))if(e.log("supress linebreak from embed !(last char)"),!this.isLastChar())return!1;if(d.hasClass("graf--iframe")||d.hasClass("graf--figure"))return this.isLastChar()&&
(this.handleLineBreakWith("p",d),this.setRangeAtText($(".is-selected")[0]),$(".is-selected").trigger("mouseup")),!1;this.tooltip_view.cleanOperationClasses($(c));c&&this.editor_menu.lineBreakReg.test(c.nodeName)&&this.isLastChar()&&(e.log("new paragraph if it's the last character"),a.preventDefault(),this.handleLineBreakWith("p",d));setTimeout(function(a){return function(){var c;c=a.getNode();if(!_.isUndefined(c))return a.setElementName($(c)),"div"===c.nodeName.toLowerCase()&&(c=a.replaceWith("p",
$(c))[0]),a.markAsSelected($(c)),a.setupFirstAndLast(),_.isEmpty($(c).text().trim())&&(_.each($(c).children(),function(a){return $(a).remove()}),$(c).append("<br>")),a.displayTooltipAt($(a.el).find(".is-selected"))}}(this),2)}if(8===a.which){this.tooltip_view.hide();e.log("removing from down");this.reachedTop&&e.log("REACHED TOP");if(this.prevented||this.reachedTop&&this.isFirstChar())return!1;e.log("pass initial validations");c=this.getNode();b=e.getNode();e.log(c);e.log(b);e.log("HANDLING WIDGET BACKSPACES");
_.each(this.widgets,function(b){return function(b){if(b.handleBackspaceKey)return b.handleBackspaceKey(a,c)}}(this));if(d.hasClass("graf--li")&&0===this.getCharacterPrecedingCaret().length)return this.handleListBackspace(d,a);$(c).hasClass("graf--p")&&this.isFirstChar&&$(c).prev().hasClass("graf--figure")&&(a.preventDefault(),$(c).prev().find("img").click(),e.log("Focus on the previous image"));if($(b).hasClass("section-content")||$(b).hasClass("graf--first"))if(e.log("SECTION DETECTED FROM KEYDOWN "+
_.isEmpty($(b).text())),_.isEmpty($(b).text()))return!1;c&&3===c.nodeType&&e.log("TextNode detected from Down!");if(($(c).hasClass("graf--mixtapeEmbed")||$(c).hasClass("graf--iframe"))&&_.isEmpty($(c).text().trim()||this.isFirstChar()))return e.log("Check for inmediate deletion on empty embed text"),(this.inmediateDeletion=this.isSelectingAll(c))&&this.handleInmediateDeletion($(c)),!1;if($(c).prev().hasClass("graf--mixtapeEmbed")&&this.isFirstChar()&&!_.isEmpty($(c).text().trim()))return!1}32===a.which&&
(e.log("SPACEBAR"),d.hasClass("graf--p")&&this.handleSmartList(d,a));_.contains([38,40],a.which)&&(e.log(a.which),this.handleArrowForKeyDown(a));c&&!_.isEmpty($(c).text())&&(this.tooltip_view.hide(),$(c).removeClass("graf--empty"));if(_.isUndefined(c)&&$(".is-selected").hasClass("is-mediaFocused"))return this.setRangeAt($(".is-selected").find("figcaption")[0]),$(".is-selected").removeClass("is-mediaFocused"),!1};b.prototype.handleKeyUp=function(a,c){var b,d;if(this.skip_keyup)return this.skip_keyup=
null,e.log("SKIP KEYUP"),!1;e.log("KEYUP");this.editor_menu.hide();this.reachedTop=!1;b=this.getNode();d=e.getNode();this.handleTextSelection(b);_.contains([8,32,13],a.which)&&$(b).hasClass("graf--li")&&this.removeSpanTag($(b));if(8===a.which){if($(d).hasClass("postField--body")&&(e.log("ALL GONE from UP"),this.handleCompleteDeletion($(this.el)),this.completeDeletion))return this.completeDeletion=!1;if($(d).hasClass("section-content")||$(d).hasClass("graf--first"))if(e.log("SECTION DETECTED FROM KEYUP "+
_.isEmpty($(d).text())),_.isEmpty($(d).text())){if(b=$(d).next(".graf")[0])this.setRangeAt(b),$(d).remove(),this.setupFirstAndLast();return!1}if(_.isNull(b))return this.handleNullAnchor(),!1;$(b).hasClass("graf--first")&&(e.log("THE FIRST ONE! UP"),this.getSelectedText()===this.getNode().textContent&&(e.log("remove selection dectected"),this.getNode().innerHTML="<br>"),this.markAsSelected(b),this.setupFirstAndLast(),!1)}if(_.contains([37,38,39,40],a.which))return this.handleArrow(a)};b.prototype.handleLineBreakWith=
function(a,c){var b;b=$("<"+a+" class='graf graf--"+a+" graf--empty is-selected'><br/></"+a+">");c.parent().is('[class^="graf--"]')?b.insertAfter(c.parent()):b.insertAfter(c);this.setRangeAt(b[0]);return this.scrollTo(b)};b.prototype.replaceWith=function(a,c){var b;b=$("<"+a+" class='graf graf--"+a+" graf--empty is-selected'><br/></"+a+">");c.replaceWith(b);this.setRangeAt(b[0]);this.scrollTo(b);return b};b.prototype.displayTooltipAt=function(a){e.log("POSITION FOR TOOLTIP");if((a=$(a))&&!_.isUndefined(a)&&
!_.isEmpty(a)&&"LI"!==a[0].tagName&&(this.tooltip_view.hide(),_.isEmpty(a.text())))return this.positions=a.offset(),this.tooltip_view.render(),this.tooltip_view.move(this.positions)};b.prototype.markAsSelected=function(a){if(!_.isUndefined(a)&&($(this.el).find(".is-selected").removeClass("is-mediaFocused is-selected"),$(a).addClass("is-selected"),$(a).find(".defaultValue").remove(),$(a).hasClass("graf--first")&&(this.reachedTop=!0,0===$(a).find("br").length)))return $(a).append("<br>")};b.prototype.addClassesToElement=
function(a){var c;c=a.nodeName.toLowerCase();switch(c){case "p":case "pre":case "div":$(a).hasClass("graf--mixtapeEmbed")||$(a).removeClass().addClass("graf graf--"+c);"p"===c&&0===$(a).find("br").length&&$(a).append("<br>");break;case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":"h1"===c?(c=$("<h2 class='graf graf--h2'>"+$(a).text()+"</h2>"),$(a).replaceWith(c),this.setElementName(a)):$(a).removeClass().addClass("graf graf--"+c);break;case "code":$(a).unwrap().wrap("<p class='graf graf--pre'></p>");
a=$(a).parent();break;case "ol":case "ul":e.log("lists");$(a).removeClass().addClass("postList");_.each($(a).find("li"),function(a){return $(a).removeClass().addClass("graf graf--li")});break;case "img":e.log("images");this.uploader_widget.uploadExistentImage(a);break;case "a":case "strong":case "em":case "br":case "b":case "u":case "i":e.log("links");$(a).wrap("<p class='graf graf--p'></p>");a=$(a).parent();break;case "blockquote":a=$(a).removeClass().addClass("graf graf--"+c);break;case "figure":$(a).hasClass(".graf--figure")&&
(a=$(a));break;default:$(a).wrap("<p class='graf graf--"+c+"'></p>"),a=$(a).parent()}return a};b.prototype.setupElementsClasses=function(a,c){_.isUndefined(a)?this.element=$(this.el).find(".section-inner"):this.element=a;return setTimeout(function(a){return function(){a.cleanContents(a.element);a.wrapTextNodes(a.element);_.each(a.element.children(),function(c){$(c).prop("tagName").toLowerCase();c=a.addClassesToElement(c);return a.setElementName(c)});a.setupLinks(a.element.find("a"));a.setupFirstAndLast();
if(_.isFunction(c))return c()}}(this),20)};b.prototype.cleanContents=function(a){_.isUndefined(a)?this.element=$(this.el).find(".section-inner"):this.element=a;a=new Sanitize({elements:"strong img em br a blockquote b u i pre p h1 h2 h3 h4 ul ol li".split(" "),attributes:{__ALL__:["class"],a:["href","title","target"],img:["src"]},protocols:{a:{href:["http","https","mailto"]}},transformers:[function(a){return"span"===a.node_name&&$(a.node).hasClass("defaultValue")?{whitelist_nodes:[a.node]}:null},
function(a){return"div"===a.node_name&&$(a.node).hasClass("graf--mixtapeEmbed")?{whitelist_nodes:[a.node]}:"a"===a.node_name&&$(a.node).parent(".graf--mixtapeEmbed").exists()?{attr_whitelist:["style"]}:null},function(a){return"figure"===a.node_name&&$(a.node).hasClass("graf--iframe")?{whitelist_nodes:[a.node]}:"div"===a.node_name&&$(a.node).hasClass("iframeContainer")&&$(a.node).parent(".graf--iframe").exists()?{whitelist_nodes:[a.node]}:"iframe"===a.node_name&&$(a.node).parent(".iframeContainer").exists()?
{whitelist_nodes:[a.node]}:"figcaption"===a.node_name&&$(a.node).parent(".graf--iframe").exists()?{whitelist_nodes:[a.node]}:null},function(a){return"figure"===a.node_name&&$(a.node).hasClass("graf--figure")?{whitelist_nodes:[a.node]}:"div"===a.node_name&&$(a.node).hasClass("aspectRatioPlaceholder")&&$(a.node).parent(".graf--figure").exists()?{whitelist_nodes:[a.node]}:"div"===a.node_name&&$(a.node).hasClass("aspect-ratio-fill")&&$(a.node).parent(".aspectRatioPlaceholder").exists()?{whitelist_nodes:[a.node]}:
"img"===a.node_name&&$(a.node).parent(".graf--figure").exists()?{whitelist_nodes:[a.node]}:"a"===a.node_name&&$(a.node).parent(".graf--mixtapeEmbed").exists()?{attr_whitelist:["style"]}:"figcaption"===a.node_name&&$(a.node).parent(".graf--figure").exists()?{whitelist_nodes:[a.node]}:"span"===a.node_name&&$(a.node).parent(".imageCaption").exists()?{whitelist_nodes:[a.node]}:null}]});if(this.element.exists())return e.log("CLEAN HTML "+this.element[0].tagName),this.element.html(a.clean_node(this.element[0]))};
b.prototype.setupLinks=function(a){return _.each(a,function(a){return function(b){return a.setupLink(b)}}(this))};b.prototype.setupLink=function(a){var b;b=$(a).parent().prop("tagName").toLowerCase();$(a).addClass("markup--anchor markup--"+b+"-anchor");b=$(a).attr("href");return $(a).attr("data-href",b)};b.prototype.preCleanNode=function(a){var b;b=new Sanitize({elements:"strong em br a b u i ul ol li".split(" "),attributes:{a:["href","title","target"]},protocols:{a:{href:["http","https","mailto"]}}});
$(a).html(b.clean_node(a[0]));a=this.addClassesToElement($(a)[0]);return $(a)};b.prototype.setupFirstAndLast=function(){var a;a=$(this.el).find(".section-inner").children();a.removeClass("graf--last , graf--first");a.first().addClass("graf--first");return a.last().addClass("graf--last")};b.prototype.wrapTextNodes=function(a){_.isUndefined(a)&&(a=$(this.el).find(".section-inner"));return a.contents().filter(function(){return 3===this.nodeType&&0<this.data.trim().length}).wrap("<p class='graf grap--p'></p>")};
b.prototype.setElementName=function(a){return $(a).attr("name",e.generateUniqueName())};b.prototype.listify=function(a,b,d){e.log("LISTIFY PARAGRAPH");this.removeSpanTag(a);d=a.html().replace(/&nbsp;/g," ").replace(d,"");switch(b){case "ul":b=$("<ul></ul>");break;case "ol":b=$("<ol></ol>");break;default:return!1}this.addClassesToElement(b[0]);this.replaceWith("li",a);a=$(".is-selected");this.setElementName(a[0]);a.html(d).wrap(b);0===a.find("br").length&&a.append("<br/>");this.setRangeAt(a[0]);return a[0]};
b.prototype.handleSmartList=function(a,b){var d,k,h;e.log("HANDLE A SMART LIST");k=this.getCharacterPrecedingCaret();if(h=k.match(/^\s*(\-|\*)\s*$/))e.log("CREATING LIST ITEM"),b.preventDefault(),d=new RegExp(/\s*(\-|\*)\s*/),d=this.listify(a,"ul",d);else if(h=k.match(/^\s*1(\.|\))\s*$/))e.log("CREATING LIST ITEM"),b.preventDefault(),d=new RegExp(/\s*1(\.|\))\s*/),d=this.listify(a,"ol",d);return d};b.prototype.handleListLineBreak=function(a,b){var d,k,h;e.log("LIST LINE BREAK");this.tooltip_view.hide();
d=a.parent("ol, ul");k=$("<p></p>");e.log(a.prev());1===d.children().length&&""===a.text()?this.replaceWith("p",d):""===a.text()&&0!==a.next().length?b.preventDefault():0===a.next().length&&(""===a.text()?(b.preventDefault(),e.log("BREAK FROM LIST"),d.after(k),a.addClass("graf--removed").remove()):0!==a.prev().length&&""===a.prev().text()&&""===this.getCharacterPrecedingCaret()&&(b.preventDefault(),e.log("PREV IS EMPTY"),h=a.html(),d.after(k),a.prev().remove(),a.addClass("graf--removed").remove(),
k.html(h)));d&&0===d.children().length&&d.remove();e.log(a);if(a.hasClass("graf--removed"))return e.log("ELEMENT REMOVED"),this.addClassesToElement(k[0]),this.setRangeAt(k[0]),this.markAsSelected(k[0]),this.scrollTo(k)};b.prototype.handleListBackspace=function(a,b){var d,k,h;d=a.parent("ol, ul");e.log("LIST BACKSPACE");if(0===a.prev().length)return b.preventDefault(),d.before(a),h=a.html(),this.replaceWith("p",a),k=$(".is-selected"),k.removeClass("graf--empty").html(h),0===d.children().length&&d.remove(),
this.setupFirstAndLast()};b.prototype.removeSpanTag=function(a){var b,e,d,h;b=a.find("span");d=0;for(h=b.length;d<h;d++)e=b[d],$(e).hasClass("defaultValue")||$(e).replaceWith($(e).html());return a};return b}(Dante.View)}).call(this);
(function(){var e=function(e,d){return function(){return e.apply(d,arguments)}},l={}.hasOwnProperty,m=function(e,d){function b(){this.constructor=e}for(var a in d)l.call(d,a)&&(e[a]=d[a]);b.prototype=d.prototype;e.prototype=new b;e.__super__=d.prototype;return e};Dante.View.TooltipWidget=function(h){function d(){this.hide=e(this.hide,this);return d.__super__.constructor.apply(this,arguments)}m(d,h);d.prototype.initialize=function(b){null==b&&(b={});this.icon=b.icon;return this.actionEvent=this.title=
b.title};d.prototype.hide=function(){return this.current_editor.tooltip_view.hide()};return d}(Dante.View)}).call(this);
(function(){var e,l=function(e,b){return function(){return e.apply(b,arguments)}},m={}.hasOwnProperty,h=function(e,b){function a(){this.constructor=e}for(var c in b)m.call(b,c)&&(e[c]=b[c]);a.prototype=b.prototype;e.prototype=new a;e.__super__=b.prototype;return e};e=Dante.utils;Dante.View.TooltipWidget.Uploader=function(d){function b(){this.handleBackspaceKey=l(this.handleBackspaceKey,this);this.uploadCompleted=l(this.uploadCompleted,this);this.updateProgressBar=l(this.updateProgressBar,this);this.uploadFile=
l(this.uploadFile,this);this.uploadFiles=l(this.uploadFiles,this);return b.__super__.constructor.apply(this,arguments)}h(b,d);b.prototype.initialize=function(a){null==a&&(a={});this.icon=a.icon||"icon-image";this.title=a.title||"Add an image";this.action=a.action||"menu-image";return this.current_editor=a.current_editor};b.prototype.handleClick=function(a){return this.imageSelect(a)};b.prototype.insertTemplate=function(){return"<figure contenteditable='false' class='graf graf--figure is-defaultValue' name='"+
e.generateUniqueName()+"' tabindex='0'> <div style='' class='aspectRatioPlaceholder is-locked'> <div style='padding-bottom: 100%;' class='aspect-ratio-fill'></div> <img src='' data-height='' data-width='' data-image-id='' class='graf-image' data-delayed-src=''> </div> <figcaption contenteditable='true' data-default-value='Type caption for image (optional)' class='imageCaption'> <span class='defaultValue'>Type caption for image (optional)</span> <br> </figcaption> </figure>"};b.prototype.uploadExistentImage=
function(a,b){var d,k,h;e.log("process image here!");h=$(this.insertTemplate());h.find("img").attr("src",this.current_editor.default_loading_placeholder);if(0<$(a).parents(".graf").length){if($(a).parents(".graf").hasClass("graf--figure"))return;e.log("UNO");h.insertBefore($(a).parents(".graf"));if(d=this.current_editor.getNode())this.current_editor.preCleanNode($(d)),this.current_editor.addClassesToElement(d)}else e.log("DOS"),d=$(a).parentsUntil(".section-inner").first(),$(d).replaceWith(h);e.log($("[name='"+
h.attr("name")+"']").attr("name"));this.replaceImg(a,$("[name='"+h.attr("name")+"']"));k=$("[name='"+h.attr("name")+"']").parentsUntil(".section-inner").length;if(0!==k)for(d=0,--k;d<=k;d+=1)$("[name='"+h.attr("name")+"']").unwrap();return e.log("FIG")};b.prototype.replaceImg=function(a,b){var d,k;e.log(b.attr("name"));e.log(b);$(a).remove();d=new Image;d.src=a.src;k=this;return d.onload=function(){var d;e.log("replace image with loaded info");e.log(b.attr("name"));e.log(this.width+"x"+this.height);
d=k.getAspectRatio(this.width,this.height);b.find(".aspectRatioPlaceholder").css({"max-width":d.width,"max-height":d.height});b.find(".graf-image").attr({"data-height":this.height,"data-width":this.width});b.find(".aspect-ratio-fill").css({"padding-bottom":""+d.ratio+"%"});return b.find("img").attr("src",a.src)}};b.prototype.displayAndUploadImages=function(a){return this.displayCachedImage(a)};b.prototype.imageSelect=function(a){var b;a=$('<input type="file" multiple="multiple">').click();b=this;
return a.change(function(){return b.uploadFiles(this.files)})};b.prototype.displayCachedImage=function(a){var b;this.current_editor.tooltip_view.hide();b=new FileReader;b.onload=function(b){return function(c){var d,h;d=new Image;d.src=c.target.result;h=b.current_editor.getNode();return d.onload=function(){var d,l;d=$(b.insertTemplate());l=$(d).insertBefore($(h));d=d.find("img.graf-image").attr("src",c.target.result);d.height=this.height;d.width=this.width;e.log("UPLOADED SHOW FROM CACHE");d=b.getAspectRatio(this.width,
this.height);l.find(".aspectRatioPlaceholder").css({"max-width":d.width,"max-height":d.height});l.find(".graf-image").attr({"data-height":this.height,"data-width":this.width});l.find(".aspect-ratio-fill").css({"padding-bottom":""+d.ratio+"%"});return b.uploadFile(a,l)}}}(this);return b.readAsDataURL(a)};b.prototype.getAspectRatio=function(a,b){var d,k,h;h=a;d=b;700<h?(k=700/h,d*=k,h*=k):700<d&&(k=700/d,h*=k,d*=k);d={width:h,height:d,ratio:d/h*100};e.log(d);return d};b.prototype.formatData=function(a){var b;
b=new FormData;b.append("file",a);return b};b.prototype.uploadFiles=function(a){var b,d,e,h;b={"image/png":!0,"image/jpeg":!0,"image/gif":!0};e=0;for(h=[];e<a.length;)d=a[e],!0===b[d.type]&&($(this.placeholder).append('<progress class="progress" min="0" max="100" value="0">0</progress>'),this.displayAndUploadImages(d)),h.push(e++);return h};b.prototype.uploadFile=function(a,b){var d;d=function(a){return function(d){return a.uploadCompleted(d,b)}}(this);return $.ajax({type:"post",url:this.current_editor.upload_url,
xhr:function(a){return function(){var b;b=new XMLHttpRequest;b.upload.onprogress=a.updateProgressBar;return b}}(this),cache:!1,contentType:!1,success:function(a){return function(b){a.current_editor.upload_callback&&(b=a.current_editor.upload_callback(b));d(b)}}(this),error:function(a){return function(a){return e.log("ERROR: got error uploading file "+a.responseText)}}(this),processData:!1,data:this.formatData(a)})};b.prototype.updateProgressBar=function(a){$(".progress:first",this.$el);if(a.lengthComputable)return a=
a.loaded/a.total*100,a=null!=a?a:{complete:0},e.log("complete"),e.log(a)};b.prototype.uploadCompleted=function(a,b){return b.find("img").attr("src",a)};b.prototype.handleBackspaceKey=function(a,b){return!$(".is-selected").hasClass("graf--figure")||"undefined"!==typeof anchor_node&&null!==anchor_node?!1:(e.log("Replacing selected node"),this.current_editor.replaceWith("p",$(".is-selected")),a.preventDefault(),this.current_editor.setRangeAt($(".is-selected")[0]),!0)};return b}(Dante.View.TooltipWidget)}).call(this);
(function(){var e,l=function(d,b){return function(){return d.apply(b,arguments)}},m={}.hasOwnProperty,h=function(d,b){function a(){this.constructor=d}for(var c in b)m.call(b,c)&&(d[c]=b[c]);a.prototype=b.prototype;d.prototype=new a;d.__super__=b.prototype;return d};e=Dante.utils;Dante.View.TooltipWidget.Embed=function(d){function b(){this.getEmbedFromNode=l(this.getEmbedFromNode,this);return b.__super__.constructor.apply(this,arguments)}h(b,d);b.prototype.initialize=function(a){null==a&&(a={});this.icon=
a.icon||"icon-video";this.title=a.title||"Add a video";this.action=a.action||"embed";return this.current_editor=a.current_editor};b.prototype.handleClick=function(a){return this.displayEmbedPlaceHolder(a)};b.prototype.handleEnterKey=function(a,b){if(b.hasClass("is-embedable"))return this.getEmbedFromNode(b)};b.prototype.embedTemplate=function(){return"<figure contenteditable='false' class='graf--figure graf--iframe graf--first' name='504e' tabindex='0'> <div class='iframeContainer'> <iframe frameborder='0' width='700' height='393' data-media-id='' src='' data-height='480' data-width='854'> </iframe> </div> <figcaption contenteditable='true' data-default-value='Type caption for embed (optional)' class='imageCaption'> <a rel='nofollow' class='markup--anchor markup--figure-anchor' data-href='' href='' target='_blank'> </a> </figcaption> </figure>"};
b.prototype.displayEmbedPlaceHolder=function(){var a;a=this.current_editor.embed_placeholder;this.node=this.current_editor.getNode();$(this.node).html(a).addClass("is-embedable");this.current_editor.setRangeAt(this.node);this.hide();return!1};b.prototype.getEmbedFromNode=function(a){this.node=$(a);this.node_name=this.node.attr("name");this.node.addClass("spinner");return $.getJSON(""+this.current_editor.oembed_url+$(this.node).text()).success(function(a){return function(b){var d,h;a.node=$("[name="+
a.node_name+"]");d=$(b.html).prop("src");h=$(a.embedTemplate());h.attr("name",a.node.attr("name"));$(a.node).replaceWith(h);h=$(".graf--iframe[name="+a.node.attr("name")+"]");h.find("iframe").attr("src",d);b=b.url||b.author_url;e.log("URL IS "+b);h.find(".markup--anchor").attr("href",b).text(b);return a.hide()}}(this)).error(function(a){return function(b){return a.node.removeClass("spinner")}}(this))};return b}(Dante.View.TooltipWidget)}).call(this);
(function(){var e,l=function(d,b){return function(){return d.apply(b,arguments)}},m={}.hasOwnProperty,h=function(d,b){function a(){this.constructor=d}for(var c in b)m.call(b,c)&&(d[c]=b[c]);a.prototype=b.prototype;d.prototype=new a;d.__super__=b.prototype;return d};e=Dante.utils;Dante.View.TooltipWidget.EmbedExtract=function(d){function b(){this.getExtract=l(this.getExtract,this);this.getExtractFromNode=l(this.getExtractFromNode,this);return b.__super__.constructor.apply(this,arguments)}h(b,d);b.prototype.initialize=
function(a){null==a&&(a={});this.icon=a.icon||"icon-embed";this.title=a.title||"Add an embed";this.action=a.action||"embed-extract";return this.current_editor=a.current_editor};b.prototype.handleClick=function(a){return this.displayExtractPlaceHolder(a)};b.prototype.handleEnterKey=function(a,b){if(b.hasClass("is-extractable"))return this.getExtractFromNode(b)};b.prototype.extractTemplate=function(){return"<div class='graf graf--mixtapeEmbed is-selected' name=''> <a target='_blank' data-media-id='' class='js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock' href=''> </a> <a data-tooltip-type='link' data-tooltip-position='bottom' data-tooltip='' title='' class='markup--anchor markup--mixtapeEmbed-anchor' data-href='' href='' target='_blank'> <strong class='markup--strong markup--mixtapeEmbed-strong'></strong> <em class='markup--em markup--mixtapeEmbed-em'></em> </a> </div>"};
b.prototype.displayExtractPlaceHolder=function(){var a;a=this.current_editor.extract_placeholder;this.node=this.current_editor.getNode();$(this.node).html(a).addClass("is-extractable");this.current_editor.setRangeAt(this.node);this.hide();return!1};b.prototype.getExtractFromNode=function(a){this.node=$(a);this.node_name=this.node.attr("name");this.node.addClass("spinner");return $.getJSON(""+this.current_editor.extract_url+$(this.node).text()).success(function(a){return function(b){var d;a.node=$("[name="+
a.node_name+"]");$(b.html).prop("src");d=$(a.extractTemplate());d.attr("name",a.node.attr("name"));$(a.node).replaceWith(d);d=$(".graf--mixtapeEmbed[name="+a.node.attr("name")+"]");d.find("strong").text(b.title);d.find("em").text(b.description);d.append(b.provider_url);d.find(".markup--anchor").attr("href",b.url);_.isEmpty(b.images)||(d=d.find(".mixtapeImage"),d.css("background-image","url("+b.images[0].url+")"),d.removeClass("mixtapeImage--empty u-ignoreBlock"));return a.hide()}}(this)).error(function(a){return function(b){return a.node.removeClass("spinner")}}(this))};
b.prototype.getExtract=function(a){return $.getJSON(""+this.current_editor.extract_url+a).done(function(a){return e.log(a)})};return b}(Dante.View.TooltipWidget)}).call(this);
(function(){var e,l=function(d,b){return function(){return d.apply(b,arguments)}},m={}.hasOwnProperty,h=function(d,b){function a(){this.constructor=d}for(var c in b)m.call(b,c)&&(d[c]=b[c]);a.prototype=b.prototype;d.prototype=new a;d.__super__=b.prototype;return d};e=Dante.utils;Dante.Editor.Tooltip=function(d){function b(){this.hide=l(this.hide,this);this.toggleOptions=l(this.toggleOptions,this);this.render=l(this.render,this);this.initialize=l(this.initialize,this);return b.__super__.constructor.apply(this,
arguments)}h(b,d);b.prototype.el=".inlineTooltip";b.prototype.events={"click .inlineTooltip-button.control":"toggleOptions","click .inlineTooltip-menu button":"handleClick"};b.prototype.initialize=function(a){null==a&&(a={});this.current_editor=a.editor;return this.widgets=a.widgets};b.prototype.template=function(){var a;a="";_.each(this.widgets,function(b){return a+="<button class='inlineTooltip-button scale' title='"+b.title+"' data-action='inline-menu-"+b.action+"' "+(b.action_value?"data-action-value='"+
b.action_value+"'":"")+"> <span class='tooltip-icon "+b.icon+"'></span> </button>"});return"<button class='inlineTooltip-button control' title='Close Menu' data-action='inline-menu'> <span class='tooltip-icon icon-plus'></span> </button> <div class='inlineTooltip-menu'> "+a+" </div>"};b.prototype.findWidgetByAction=function(a){return _.find(this.widgets,function(b){return b.action===a})};b.prototype.render=function(){$(this.el).html(this.template());$(this.el).addClass("is-active");return this};b.prototype.toggleOptions=
function(){e.log("Toggle Options!!");$(this.el).toggleClass("is-scaled");return!1};b.prototype.move=function(a){var b,d;b=$(this.el);d=b.find(".control").css("width");b=b.find(".inlineTooltip-menu").css("padding-left");d=parseInt(d.replace(/px/,""))+parseInt(b.replace(/px/,""));d=a.left-d;a=a.top;return $(this.el).offset({top:a,left:d})};b.prototype.handleClick=function(a){var b,d;d=$(a.currentTarget).data("action");e.log(d);d=d.replace("inline-menu-","");(b=this.findWidgetByAction(d))&&b.handleClick(a);
return!1};b.prototype.cleanOperationClasses=function(a){return a.removeClass("is-embedable is-extractable")};b.prototype.hide=function(){return $(this.el).removeClass("is-active is-scaled")};return b}(Dante.View)}).call(this);
(function(){var e,l={}.hasOwnProperty,m=function(e,d){function b(){this.constructor=e}for(var a in d)l.call(d,a)&&(e[a]=d[a]);b.prototype=d.prototype;e.prototype=new b;e.__super__=d.prototype;return e};e=Dante.utils;Dante.Editor.PopOver=function(h){function d(){return d.__super__.constructor.apply(this,arguments)}m(d,h);d.prototype.el="body";d.prototype.events={"mouseover .popover":"cancelHide","mouseout  .popover":"hide"};d.prototype.initialize=function(b){null==b&&(b={});e.log("initialized popover");
this.editor=b.editor;this.hideTimeout;return this.settings={timeout:300}};d.prototype.template=function(){return"<div class='popover popover--tooltip popover--Linktooltip popover--bottom is-active'> <div class='popover-inner'> <a href='#' target='_blank'> Link </a> </div> <div class='popover-arrow'> </div> </div>"};d.prototype.positionAt=function(b){var a,c,d,e,h;b=$(b.currentTarget);e=this.resolveTargetPosition(b);d=b.offset();h=b.outerWidth();c=b.outerHeight();a=$(this.el).find(".popover").outerWidth();
c=e.top+c;a=d.left+h/2-a/2;$(this.el).find(".popover").css("top",c).css("left",a).show();return this.handleDirection(b)};d.prototype.displayAt=function(b){var a;this.cancelHide();a=$(b.currentTarget);$(this.el).find(".popover-inner a").text(a.attr("href")).attr("href",a.attr("href"));this.positionAt(b);$(this.el).find(".popover--tooltip").css("pointer-events","auto");return $(this.el).show()};d.prototype.cancelHide=function(){e.log("Cancel Hide");return clearTimeout(this.hideTimeout)};d.prototype.hide=
function(b){this.cancelHide();return this.hideTimeout=setTimeout(function(a){return function(){return $(a.el).find(".popover").hide()}}(this),this.settings.timeout)};d.prototype.resolveTargetPosition=function(b){return b.parents(".graf--mixtapeEmbed").exists()?b.parents(".graf--mixtapeEmbed").position():b.position()};d.prototype.handleDirection=function(b){return b.parents(".graf--mixtapeEmbed").exists()?$(this.el).find(".popover").removeClass("popover--bottom").addClass("popover--top"):$(this.el).find(".popover").removeClass("popover--top").addClass("popover--bottom")};
d.prototype.render=function(){return $(this.template()).insertAfter(this.editor.$el)};return d}(Dante.View)}).call(this);
(function(){var e,l=function(d,b){return function(){return d.apply(b,arguments)}},m={}.hasOwnProperty,h=function(d,b){function a(){this.constructor=d}for(var c in b)m.call(b,c)&&(d[c]=b[c]);a.prototype=b.prototype;d.prototype=new a;d.__super__=b.prototype;return d};e=Dante.utils;Dante.Editor.Menu=function(d){function b(){this.createlink=l(this.createlink,this);this.handleInputEnter=l(this.handleInputEnter,this);this.render=l(this.render,this);this.template=l(this.template,this);this.initialize=l(this.initialize,
this);return b.__super__.constructor.apply(this,arguments)}h(b,d);b.prototype.el="#dante-menu";b.prototype.events={"mousedown li":"handleClick","click .dante-menu-linkinput .dante-menu-button":"closeInput","keypress input":"handleInputEnter"};b.prototype.initialize=function(a){null==a&&(a={});this.config=a.buttons||this.default_config();this.current_editor=a.editor;this.commandsReg={block:/^(?:p|h[1-6]|blockquote|pre)$/,inline:/^(?:bold|italic|underline|insertorderedlist|insertunorderedlist|indent|outdent)$/,
source:/^(?:insertimage|createlink|unlink)$/,insert:/^(?:inserthorizontalrule|insert)$/,wrap:/^(?:code)$/};this.lineBreakReg=/^(?:blockquote|pre|div|p)$/i;this.effectNodeReg=/(?:[pubia]|h[1-6]|blockquote|[uo]l|li)/i;return this.strReg={whiteSpace:/(^\s+)|(\s+$)/g,mailTo:/^(?!mailto:|.+\/|.+#|.+\?)(.*@.*\..+)$/,http:/^(?!\w+?:\/\/|mailto:|\/|\.\/|\?|#)(.*)$/}};b.prototype.default_config=function(){return{buttons:"bold italic h2 h3 h4 blockquote createlink".split(" ")}};b.prototype.template=function(){var a;
a="<div class='dante-menu-linkinput'><input class='dante-menu-input' placeholder='http://'><div class='dante-menu-button'>x</div></div>";a+="<ul class='dante-menu-buttons'>";_.each(this.config.buttons,function(b){return a+="<li class='dante-menu-button'><i class=\"dante-icon icon-"+b+'" data-action="'+b+'"></i></li>'});return a+="</ul>"};b.prototype.render=function(){$(this.el).html(this.template());return this.show()};b.prototype.handleClick=function(a){var b,d;b=$(a.currentTarget).find(".dante-icon").data("action");
d=$(this.el).find("input.dante-menu-input");e.log("menu "+b+" item clicked!");this.savedSel=e.saveSelection();/(?:createlink)/.test(b)?$(a.currentTarget).hasClass("active")?this.removeLink():($(this.el).addClass("dante-menu--linkmode"),d.focus()):this.menuApply(b);return!1};b.prototype.closeInput=function(a){$(this.el).removeClass("dante-menu--linkmode");return!1};b.prototype.handleInputEnter=function(a){if(13===a.which)return e.restoreSelection(this.savedSel),this.createlink($(a.target))};b.prototype.removeLink=
function(){var a;this.menuApply("unlink");a=this.current_editor.getNode();return this.current_editor.cleanContents($(a))};b.prototype.createlink=function(a){$(this.el).removeClass("dante-menu--linkmode");return a.val()?(a=a.val().replace(this.strReg.whiteSpace,"").replace(this.strReg.mailTo,"mailto:$1").replace(this.strReg.http,"http://$1"),this.menuApply("createlink",a)):this.menuApply("unlink")};b.prototype.menuApply=function(a,b){this.commandsReg.block.test(a)?(e.log("block here"),this.commandBlock(a)):
this.commandsReg.inline.test(a)||this.commandsReg.source.test(a)?(e.log("overall here"),this.commandOverall(a,b)):this.commandsReg.insert.test(a)?(e.log("insert here"),this.commandInsert(a)):this.commandsReg.wrap.test(a)?(e.log("wrap here"),this.commandWrap(a)):e.log("can't find command function for action: "+a);return!1};b.prototype.setupInsertedElement=function(a){a=this.current_editor.addClassesToElement(a);this.current_editor.setElementName(a);return this.current_editor.markAsSelected(a)};b.prototype.cleanContents=
function(){return this.current_editor.cleanContents()};b.prototype.commandOverall=function(a,b){var d;d=" to exec \u300c"+a+"\u300d command"+(b?" with value: "+b:"");document.execCommand(a,!1,b)?(e.log("success"+d),d=this.current_editor.getNode(),this.current_editor.setupLinks($(d).find("a")),this.displayHighlights(),$(d).parent().hasClass("section-inner")&&(d=this.current_editor.addClassesToElement(d),this.current_editor.setElementName(d)),this.current_editor.handleTextSelection(d)):e.log("fail"+
d,!0)};b.prototype.commandInsert=function(a){var b;if(b=this.current_editor.current_node)return this.current_editor.current_range.selectNode(b),this.current_editor.current_range.collapse(!1),this.commandOverall(b,a)};b.prototype.commandBlock=function(a){-1!==this.effectNode(this.current_editor.getNode(this.current_editor.current_node),!0).indexOf(a)&&(a="p");return this.commandOverall("formatblock",a)};b.prototype.commandWrap=function(a){return this.commandOverall("insertHTML","<"+a+">"+selection+
"</"+a+">")};b.prototype.effectNode=function(a,b){var d;d=[];for(a=a||this.current_editor.$el[0];a!==this.current_editor.$el[0];)a.nodeName.match(this.effectNodeReg)&&d.push(b?a.nodeName.toLowerCase():a),a=a.parentNode;return d};b.prototype.displayHighlights=function(){var a;$(this.el).find(".active").removeClass("active");a=this.effectNode(e.getNode());e.log(a);return _.each(a,function(a){return function(b){var d;d=b.nodeName.toLowerCase();switch(d){case "a":$(a.el).find("input").val($(b).attr("href"));
d="createlink";break;case "i":d="italic";break;case "u":d="underline";break;case "b":d="bold";break;case "code":d="code";break;case "ul":d="insertunorderedlist";break;case "ol":d="insertorderedlist";break;case "li":d="indent",e.log("nothing to select")}d.match(/(?:h[1-6])/i)?$(a.el).find(".icon-bold, .icon-italic, .icon-blockquote").parent("li").remove():"indent"===d&&$(a.el).find(".icon-h2, .icon-h3, .icon-h4, .icon-blockquote").parent("li").remove();return a.highlight(d)}}(this))};b.prototype.highlight=
function(a){return $(".icon-"+a).parent("li").addClass("active")};b.prototype.show=function(){$(this.el).addClass("dante-menu--active");this.closeInput();return this.displayHighlights()};b.prototype.hide=function(){return $(this.el).removeClass("dante-menu--active")};return b}(Dante.View)}).call(this);
(function(e,l,m){Dante.Editor.Tooltip.prototype.move=function(h){var d,b;d=e(this.el);b=d.find(".control").css("width");d=d.find(".inlineTooltip-menu").css("padding-right");b=parseInt(b.replace(/px/,""))+parseInt(d.replace(/px/,""));b=h.right-b;h=h.top;return e(this.el).offset({top:h,right:b})};Dante.View.TooltipWidget.Embed.prototype.getEmbedFromNode=function(h){this.node=e(h);this.node_name=this.node.attr("name");this.node.addClass("spinner");return e.getJSON(""+this.current_editor.oembed_url+e(this.node).text().split("").reverse().join("")).success(function(d){return function(b){var a;
d.node=e("[name="+d.node_name+"]");b=e(b.html).prop("src");a=e(d.embedTemplate());a.attr("name",d.node.attr("name"));e(d.node).replaceWith(a);e(".graf--iframe[name="+d.node.attr("name")+"]").find("iframe").attr("src",b);return d.hide()}}(this))};Dante.View.TooltipWidget.EmbedExtract.prototype.getExtractFromNode=function(h){this.node=e(h);this.node_name=this.node.attr("name");this.node.addClass("spinner");return e.getJSON(""+this.current_editor.extract_url+e(this.node).text().split("").reverse().join("")).success(function(d){return function(b){var a;
d.node=e("[name="+d.node_name+"]");e(b.html).prop("src");a=e(d.extractTemplate());a.attr("name",d.node.attr("name"));e(d.node).replaceWith(a);a=e(".graf--mixtapeEmbed[name="+d.node.attr("name")+"]");a.find("strong").text(b.title);a.find("em").text(b.description);a.append(b.provider_url);a.find(".markup--anchor").attr("href",b.url);_.isEmpty(b.images)||(a=a.find(".mixtapeImage"),a.css("background-image","url("+b.images[0].url+")"),a.removeClass("mixtapeImage--empty u-ignoreBlock"));return d.hide()}}(this))}})(jQuery,
document);
